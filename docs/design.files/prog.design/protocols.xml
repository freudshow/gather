<!-- linux集中器xml通讯基本格式 -->
<!-- 所有字符统一使用小写英文, 避免造成字符判断的麻烦-->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<!-- 通用部分
      sadd:数据源地址，一般是集中器编号，如果上位机向集中器传输数据，则数据源地址是上位机，目的地址是集中器编号。
	  oadd：数据目的地址
      function_type:功能类型
		功能类型列表:
			1．	身份验证(id_validate)
			2．	心跳(heart_beat)
			3．	配置信息(sys_config)
			4.	配置需要哪些物理量(request_data)
			5.	配置抄表时间点(time_node)
			6.	操作表地址信息(meter_info)
			7.	抄表数据上传(report_update)
			8.	查询集中器状态(read_stat)(集中器正常/异常，如异常具体是什么异常)
			9.	ip切换通知(switch_ip)
			10.	数据库操作相关(db_mani)
			11.	执行本地系统命令或程序(local_sys_command)
			12.	远程升级(code_updata)
			13.	抄表任意透传(proto_trans)
	  oper_type:操作类型：
			1、读（read）
			2、写（write）
			3、操作（do）
			4、应答（answer）
			   操作对：读-应答、写-应答、操作-应答
    -->
	<common>
			<sadd>xxxxxx</sadd>
			<oadd>xxxxxx</oadd>
			<func_type>功能类型</func_type>
			<oper_type>read/write/do/answer</oper_type>
	</common>
	<!-- 以下各项的字段, 不同功能类型不同，须对应具体的功能类型添加, 详见下文。-->
	
	
	
</root>


<!---------------- 1. 身份验证(id_validate) ---------------->

<!-- 通用格式 -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
			<sadd>xxxx</sadd>
			<oadd>xxxx</oadd>
			<func_type>id_validate</func_type>
			<oper_type>read/write/answer</oper_type>
	</common>
	<!-- 身份验证
		state: 当前操作所处的状态;
		string：当前传输的字符串;
     -->
	<state>request_string->dispatch_string->hash_result->id_result</state>
	<string>xxxxxxxx</string>
</root>

<!-- 下位机请求上位机的"当前系统时间字符串" -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
			<sadd>5001</sadd>
			<oadd>0001</oadd>
			<func_type>id_validate</func_type>
			<oper_type>read</oper_type>
	</common>
	<state>request_string</state>
</root>

<!-- 上位机下发"当前系统时间字符串" -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
			<sadd>0001</sadd>
			<oadd>5001</oadd>
			<func_type>id_validate</func_type>
			<oper_type>answer</oper_type>
	</common>
	<state>dispatch_string</state>
	<string>0aeefd</string>
</root>

<!-- 下位机上传md5加密后的字符串 -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
			<sadd>5001</sadd>
			<oadd>0001</oadd>
			<func_type>id_validate</func_type>
			<oper_type>answer</oper_type>
	</common>
	<state>hash_result</state>
	<string>23ac9e6847cc41622affb9623998735b</string>
</root>

<!-- 上位机下发认证结果 -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
			<sadd>0001</sadd>
			<oadd>5001</oadd>
			<func_type>id_validate</func_type>
			<oper_type>answer</oper_type>
	</common>
	<state>id_result</state>
	<string>success/fail</string>
</root>



<!---------------- 2. 心跳(heart_beat) ---------------->

<!-- 上位机心跳包(空闲时的数据格式， 
	 如果有其他数据将要传输到
	 该集中器，那么就不必下发此心跳的心跳回应) 
-->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
			<sadd>5001</sadd>
			<oadd>0001</oadd>
			<func_type>heart_beat</func_type>
			<oper_type></oper_type>
	</common>
</root>

<!-- 下位机心跳包(集中器一直按照设定心跳周期主动发送心跳) -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
			<sadd>5001</sadd>
			<oadd>0001</oadd>
			<func_type>heart_beat</func_type>
			<oper_type></oper_type>
	</common>
</root>

<!-- 上位机回应心跳(如果有其他数据将要传输到该集中器，那么就不必下发此心跳的心跳回应) -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
			<sadd>0001</sadd>
			<oadd>5001</oadd>
			<func_type>heart_beat</func_type>
			<oper_type>answer</oper_type>
	</common>
</root>


<!---------------- 3. 配置信息(sys_config) ---------------->

<!-- 上位机读取下位机配置 -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>0001</sadd>
		<oadd>5001</oadd>
		<func_type>sys_config</func_type>
		<oper_type>read</oper_type>
	</common>
</root>

<!-- 下位机应答上位机的查询配置请求 -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>5001</sadd>
		<oadd>0001</oadd>
		<func_type>sys_config</func_type>
		<oper_type>answer</oper_type>
	</common>
	<primary_server>xxxx</primary_server>
	<primary_dns>xxxx</primary_dns>
	<primary_port>xxxx</primary_port>
	<second_server>xxxx</second_server>
	<second_dns>xxxx</second_dns>
	<second_port>xxxx</second_port>
	<server_id>xxxx</server_id>
	<gateway_id>xxxx</gateway_id>
	<net_type>xxxx</net_type>
	<md5_key>xxxx</md5_key>
	<aes_key>xxxx</aes_key>
	<collect_cycle>xxxx</collect_cycle>
	<report_mode>xxxx</report_mode>
	<collect_mode>xxxx</collect_mode>
	<beat_cycle>xxxx</beat_cycle>
</root>

<!-- 上位机设置下位机配置-->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>0001</sadd>
		<oadd>5001</oadd>
		<func_type>sys_config</func_type>
		<oper_type>write</oper_type>
	</common>
	<primary_server>xxxx</primary_server>
	<primary_dns>xxxx</primary_dns>
	<primary_port>xxxx</primary_port>
	<second_server>xxxx</second_server>
	<second_dns>xxxx</second_dns>
	<second_port>xxxx</second_port>
	<server_id>xxxx</server_id>
	<gateway_id>xxxx</gateway_id>
	<net_type>xxxx</net_type>
	<md5_key>xxxx</md5_key>
	<aes_key>xxxx</aes_key>
	<collect_cycle>xxxx</collect_cycle>
	<report_mode>xxxx</report_mode>
	<collect_mode>xxxx</collect_mode>
	<beat_cycle>xxxx</beat_cycle>
</root>

<!-- 下位机向上位机返回执行状态(成功/失败) -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>5001</sadd>
		<oadd>0001</oadd>
		<func_type>sys_config</func_type>
		<oper_type>answer</oper_type>
	</common>
	<result>success/fail</result>
</root>



<!---------------- 4. 配置需要哪些物理量(request_data) ---------------->

<!-- 上位机设置下位机配置-->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>0001</sadd>
		<oadd>5001</oadd>
		<func_type>request_data</func_type>
		<oper_type>write</oper_type>
	</common>
	<!--row_num说明下面共有几个row-->
	<row_num>xxx</row_num>	
	<row id="1">
		<!--列名可用宏定义替代具体字符串，以减少传输的数据量-->
		<f_meter_type>xxx</f_meter_type>
		<f_item_index>xxx</f_item_index>
	</<row>
	<row id="2">
		<f_meter_type>xxx</f_meter_type>
		<f_item_index>xxx</f_item_index>
	</<row>
	<row id="3">
		<f_meter_type>xxx</f_meter_type>
		<f_item_index>xxx</f_item_index>
	</<row>
</root>

<!-- 下位机向上位机返回执行状态(成功/失败) -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>5001</sadd>
		<oadd>0001</oadd>
		<func_type>request_data</func_type>
		<oper_type>answer</oper_type>
	</common>
	<result>success/fail</result>
</root>


<!-- 上位机向下位机请求读取requestdata配置 -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>0001</sadd>
		<oadd>5001</oadd>
		<func_type>request_data</func_type>
		<oper_type>read</oper_type>
	</common>
</root>

<!-- 下位机向上位机返回配置 -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>5001</sadd>
		<oadd>0001</oadd>
		<func_type>request_data</func_type>
		<oper_type>answer</oper_type>
	</common>
	<!--row_num说明下面共有几个row-->
	<row_num>xxx</row_num>	
	<row id="1">
		<!--列名可用宏定义替代具体字符串，以减少传输的数据量-->
		<f_meter_type>xxx</f_meter_type>
		<f_item_index>xxx</f_item_index>
	</<row>
	<row id="2">
		<f_meter_type>xxx</f_meter_type>
		<f_item_index>xxx</f_item_index>
	</<row>
	<row id="3">
		<f_meter_type>xxx</f_meter_type>
		<f_item_index>xxx</f_item_index>
	</<row>
</root>


<!---------------- 5. 配置抄表时间点(time_node) ---------------->

<!-- 上位机设置下位机配置-->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>0001</sadd>
		<oadd>5001</oadd>
		<func_type>time_node</func_type>
		<oper_type>write</oper_type>
	</common>
	<time_node>00:00;06:00...</time_node>
</root>

<!-- 下位机向上位机返回执行状态(成功/失败) -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>5001</sadd>
		<oadd>0001</oadd>
		<func_type>time_node</func_type>
		<oper_type>answer</oper_type>
	</common>
	<result>success/fail</result>
</root>


<!---------------- 6. 操作表地址信息(meter_info) ---------------->

<!--上位机下发表地址-->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>0001</sadd>
		<oadd>5001</oadd>
		<func_type>meter_info</func_type>
		<oper_type>write</oper_type>
	</common>
	<trans>
		<total_meter_num>xxx</total_meter_num><!--总共要下发的表地址数量 -->
		<frame_idx>xxx</frame_idx><!--本帧的序号 -->
		<meter_num>xxx</meter_num><!--本帧共包含多少个表地址 -->
	</trans>
	<row id="1">
		<!--列名可用宏定义替代具体字符串，以减少传输的数据量-->
		<f_device_id></f_device_id>
		<f_meter_address></f_meter_address>
		<f_meter_type></f_meter_type>
		<f_meter_proto_type></f_meter_proto_type>
		<f_meter_channel></f_meter_channel>		
		<f_install_pos></f_install_pos>		
	</row>
	<row id="2">
		<!--列名可用宏定义替代具体字符串，以减少传输的数据量-->
		<f_device_id></f_device_id>
		<f_meter_address></f_meter_address>
		<f_meter_type></f_meter_type>
		<f_meter_proto_type></f_meter_proto_type>
		<f_meter_channel></f_meter_channel>		
		<f_install_pos></f_install_pos>	
	</row>
</root>

<!-- 下位机的执行结果 -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>5001</sadd>
		<oadd>0001</oadd>
		<func_type>meter_info</func_type>
		<oper_type>answer</oper_type>
	</common>
	<result>success/fail</result>
</root>

<!-- 上位机查询下位机表地址信息 -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>0001</sadd>
		<oadd>5001</oadd>
		<func_type>meter_info</func_type>
		<oper_type>read</oper_type>
	</common>
	<!-- 可选参数trans, 用来进行错误重连时, 具体要第几帧的数据 -->
	<trans>
		<frame_idx>xxx</frame_idx><!--要查询的帧的索引 -->
	</trans>
</root>

<!-- 下位机的执行结果 -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>5001</sadd>
		<oadd>0001</oadd>
		<func_type>meter_info</func_type>
		<oper_type>answer</oper_type>
	</common>
	<trans>
		<total_meter_num>xx</total_meter_num><!--总共表地址数量 -->
		<frame_idx>xx</frame_idx><!--本帧的索引 -->
		<meter_num>xx</meter_num><!--本帧共包含多少个表地址 -->
	</trans>
	<row id="1">
		<!--列名可用宏定义替代具体字符串，以减少传输的数据量-->
		<f_device_id></f_device_id>
		<f_meter_address></f_meter_address>
		<f_meter_type></f_meter_type>
		<f_meter_proto_type></f_meter_proto_type>
		<f_meter_channel></f_meter_channel>		
		<f_install_pos></f_install_pos>	
	</row>
	<row id="2">
		<!--列名可用宏定义替代具体字符串，以减少传输的数据量-->
		<f_device_id></f_device_id>
		<f_meter_address></f_meter_address>
		<f_meter_type></f_meter_type>
		<f_meter_proto_type></f_meter_proto_type>
		<f_meter_channel></f_meter_channel>		
		<f_install_pos></f_install_pos>	
	</row>
</root>


<!---------------- 7. 抄表数据上传(report_update) ---------------->

<!-- 下位机上报抄表数据 -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>5001</sadd>
		<oadd>0001</oadd>
		<func_type>report_update</func_type>
		<oper_type>write</oper_type>
	</common>
	<result>success</result>	<!--如果抄表成功，则success-->
	<trans>
		<total_meter_num>xxx</total_meter_num><!--总共要上报的抄表数据条数 -->
		<frame_idx>xxx</frame_idx><!--本帧的索引 -->
		<meter_num>xxx</meter_num><!--本帧共包含多少条抄表数据 -->
		<time_node>xxx</time_node><!--上报的是哪个时间点的数据 -->
	</trans>
	<row id="1">
		<!--列名可用宏定义替代具体字符串，以减少传输的数据量-->
		<f_device_id_></f_device_id>
		<f_meter_address></f_meter_address>
		<f_meter_type></f_meter_type>
		<f_timenode></f_timenode>
		<f_total_active_power></f_total_active_power>
		<f_maximum_demand></f_maximum_demand>
		<f_overall_power_factor></f_overall_power_factor>
		.
		.
		.
	</row>
	.
	.
	.
	
	<!--如果抄表失败，则返回-->
	<result>fail</result>
	<stat>xxxx</stat>
</root>

<!-- 上位机的接收结果 -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>0001</sadd>
		<oadd>5001</oadd>
		<func_type>report_update</func_type>
		<oper_type>answer</oper_type>
	</common>
	<result>success/fail</result>
</root>



<!-- 上位机主动请求读定点数据 -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>0001</sadd>
		<oadd>5001</oadd>
		<func_type>report_update</func_type>
		<oper_type>read</oper_type>
	</common>
	<time>xx:xx</time>  <!--请求读xx:xx时间的抄表数据-->
</root>


<!-- 下位机返回抄表数据 -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>5001</sadd>
		<oadd>0001</oadd>
		<func_type>report_update</func_type>
		<oper_type>answer</oper_type>
	</common>
	<result>success</result>    <!--如果抄表成功，则success-->
	<trans>
		<total_meter_num>xxx</total_meter_num><!--总共要上报的抄表数据条数 -->
		<frame_idx>xxx</frame_idx><!--本帧的索引 -->
		<meter_num>xxx</meter_num><!--本帧共包含多少条抄表数据 -->
		<time_node>xxx</time_node><!--上报的是哪个时间点的数据 -->
	</trans>
	<row id="1">
		<!--列名可用宏定义替代具体字符串，以减少传输的数据量-->
		<f_device_id_></f_device_id>
		<f_meter_address></f_meter_address>
		<f_meter_type></f_meter_type>
		<f_timenode></f_timenode>
		<f_total_active_power></f_total_active_power>
		<f_maximum_demand></f_maximum_demand>
		<f_overall_power_factor></f_overall_power_factor>
		.
		.
		.
	</row>
	.
	.
	.
	<!--如果失败，则返回-->
	<result>fail</result>
	<stat>xxxx</stat>
</root>


<!--8.查询集中器状态是否有异常-->

<!-- 上位机读取集中器状态 -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>0001</sadd>
		<oadd>5001</oadd>
		<func_type>read_stat</func_type>
		<oper_type>read</oper_type>
	</common>
</root>

<!-- 集中器返回当前状态 -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>5001</sadd>
		<oadd>0001</oadd>
		<func_type>read_stat</func_type>
		<oper_type>answer</oper_type>
	</common>
	<stat>xxxxxxxx</stat>  <!--具体意义后定义-->
</root>


<!--9.集中器上报通知ip切换,上位机收到这条信息后要标记当前集中器ip不在，不能进行任何操作，一直等到集中器再次上线-->

<!-- 集中器上报切换ip -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>5001</sadd>
		<oadd>0001</oadd>
		<func_type>switch_ip</func_type>
		<oper_type>write</oper_type>
	</common>
</root>

<!-- 上位机返回切换ip -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>0001</sadd>
		<oadd>5001</oadd>
		<func_type>switch_ip</func_type>
		<oper_type>answer</oper_type>
	</common>
</root>

<!---------------- 10. 数据库操作相关(db_mani) ---------------->
<!--sql_stmt, 需要下位机执行的sql语句, 
		id属性指定本语句的序列号, 
		本语句只对上位机组帧和下位机解帧有效;
	sql_result, 下位机执行sql语句后的结果, 
		id属性指定本结果对应的sql系列号, 
		本语句只对下位机组帧和上位机解帧有效;
-->

<!--上位机直接下发sql语句, 交由数据库执行;
	可同时下发多条sql指令, 以id属性作为索引.
-->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>0001</sadd>
		<oadd>5001</oadd>
		<func_type>db_mani</func_type>
		<oper_type>do</oper_type>
	</common>
	<sql_stmt id="1">create table meter_info (id integer primary key, address integer)</sql_stmt><!--只用于上位机下发-->
</root>

<!--下位机的数据库执行结果, 返回到上位机, 
	这个错误信息是数据库返回的, 而不是二次加工过的.
	下位机返回的结果须严格对应id属性.
-->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>0001</sadd>
		<oadd>5001</oadd>
		<func_type>db_mani</func_type>
		<oper_type>answer</oper_type>
	</common>
	<sql_result id="1">no_error/具体返回结果</sql_result><!--只用于下位机返回结果-->
</root>


<!---------------- 11. 执行本地系统命令或程序(local_sys_command) ---------------->
<!--local_command, 要下位机执行的系统语句, 
		id属性指定本语句的序列号, 
		本语句只对上位机组帧和下位机解帧有效;
	exec_result, 下位机执行系统语句后的结果, 
		id属性指定本结果对应的sql系列号, 
		本语句只对下位机组帧和上位机解帧有效;
-->

<!--上位机下发下位机系统命令, 交由下位机的linux执行.-->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>0001</sadd>
		<oadd>5001</oadd>
		<func_type>local_sys_command</func_type>
		<oper_type>do</oper_type>
	</common>
	<local_command id="1">pwd</local_command><!--只用于上位机下发-->
</root>

<!-- 下位机执行上位机下发的linux命令后的结果 -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>5001</sadd>
		<oadd>0001</oadd>
		<func_type>local_sys_command</func_type>
		<oper_type>answer</oper_type>
	</common>
	<exec_result id="1">/home/root</exec_result><!--只用于下位机返回结果-->
</root>


<!---------------- 12.	远程升级(code_updata)  待定义 ---------------->



<!---------------- 13.	抄表任意透传(proto_trans)  待定义 ---------------->





<!---------------- 14.	设置集中器时钟（clock_set） ---------------->
<!-- 上位机下发集中器校时指令 -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>0001</sadd>
		<oadd>5001</oadd>
		<func_type>clock_set</func_type>
		<oper_type>write</oper_type>
	</common>
	<time>20160305121314</time>  <!--年月日时分秒-->
</root>

<!-- 校时指令集中器返回 -->
<?xml version="1.0" encoding="utf-8" ?>
<root>
	<common>
		<sadd>5001</sadd>
		<oadd>0001</oadd>
		<func_type>clock_set</func_type>
		<oper_type>answer</oper_type>
	</common>
	<result>success/fail</result>  <!--执行成功或失败-->
</root>


<!---------------------------------------------------------------------
		其他功能后期完善：
			诸如：
				设置集中器时钟、
				集中器重启、
				操作集中器立即抄表、
				集中器抄单表、
				抄单表历史数据、
				单个表地址的修改、删除、插入、
				等
----------------------------------------------------------------------->







			
			